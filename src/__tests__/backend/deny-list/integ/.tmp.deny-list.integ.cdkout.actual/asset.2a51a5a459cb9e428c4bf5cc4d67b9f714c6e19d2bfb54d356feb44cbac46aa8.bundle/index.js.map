{
  "version": 3,
  "sources": ["../../../../src/backend/deny-list/prune-queue-handler.lambda.ts", "../../../../src/backend/deny-list/constants.ts", "../../../../src/backend/shared/env.lambda-shared.ts"],
  "sourcesContent": ["import * as AWS from 'aws-sdk';\nimport { ENV_DELETE_OBJECT_DATA_BUCKET_NAME } from './constants';\nimport { requireEnv } from '../shared/env.lambda-shared';\n\nconst s3 = new AWS.S3();\n\nexport async function handler(event: AWSLambda.SQSEvent) {\n  console.log(JSON.stringify({ event }));\n\n  const bucket = requireEnv(ENV_DELETE_OBJECT_DATA_BUCKET_NAME);\n\n  const records = event.Records ?? [];\n\n  for (const record of records) {\n    const objectKey = record.body;\n    console.log(`deleting s3://${bucket}/${objectKey}`);\n    await s3.deleteObject({ Bucket: bucket, Key: objectKey }).promise();\n  }\n}\n", "/**\n * The name of an environment variable that contains the bucket name that includes the deny list.\n */\nexport const ENV_DENY_LIST_BUCKET_NAME = 'DENY_LIST_BUCKET_NAME';\n\n/**\n * The object key of the deny list in the bucket.\n */\nexport const ENV_DENY_LIST_OBJECT_KEY = 'DENY_LIST_OBJECT_KEY';\n\nexport const ENV_PRUNE_PACKAGE_DATA_BUCKET_NAME = 'PACKAGE_DATA_BUCKET_NAME';\nexport const ENV_PRUNE_PACKAGE_DATA_KEY_PREFIX = 'PACKAGE_DATA_KEY_PREFIX';\nexport const ENV_PRUNE_QUEUE_URL = 'PRUNE_QUEUE_URL';\nexport const ENV_PRUNE_ON_CHANGE_FUNCTION_NAME = 'ON_CHANGE_FUNCTION_NAME';\n\nexport const ENV_DELETE_OBJECT_DATA_BUCKET_NAME = 'PACKAGE_DATA_BUCKET_NAME';\n\nexport const METRICS_NAMESPACE = 'ConstructHub/DenyList';\n\nexport const enum MetricName {\n  DENY_LIST_RULE_COUNT = 'DenyListRuleCount',\n}\n", "import { env } from 'process';\n\nexport function requireEnv(name: string): string {\n  const result = env[name];\n  if (!result) {\n    throw new Error(\n      `No value specified for required environment variable: ${name}`\n    );\n  }\n  return result;\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAAqB;;;ACed,IAAM,qCAAqC;;;ACflD,qBAAoB;AAEb,SAAS,WAAW,MAAsB;AAC/C,QAAM,SAAS,mBAAI,IAAI;AACvB,MAAI,CAAC,QAAQ;AACX,UAAM,IAAI;AAAA,MACR,yDAAyD,IAAI;AAAA,IAC/D;AAAA,EACF;AACA,SAAO;AACT;;;AFNA,IAAM,KAAK,IAAQ,OAAG;AAEtB,eAAsB,QAAQ,OAA2B;AACvD,UAAQ,IAAI,KAAK,UAAU,EAAE,MAAM,CAAC,CAAC;AAErC,QAAM,SAAS,WAAW,kCAAkC;AAE5D,QAAM,UAAU,MAAM,WAAW,CAAC;AAElC,aAAW,UAAU,SAAS;AAC5B,UAAM,YAAY,OAAO;AACzB,YAAQ,IAAI,iBAAiB,MAAM,IAAI,SAAS,EAAE;AAClD,UAAM,GAAG,aAAa,EAAE,QAAQ,QAAQ,KAAK,UAAU,CAAC,EAAE,QAAQ;AAAA,EACpE;AACF;",
  "names": []
}
